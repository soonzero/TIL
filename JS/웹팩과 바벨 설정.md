# 웹팩과 바벨 설정

## CRA 기준 구성

```
├─ dist
├─ package-lock.json
├─ package.json
├─ public
│  └─ index.html
├─ src
│  ├─ App.js
│  ├─ index.js
│  └─ index.css
└─ webpack.config.js
```

- `public`: HTML 기본 템플릿이나 이미지 파일 같이 절대경로로 쓰이는 파일이 위치한 장소

- `src`: 기본적으로 작성하는 소스 코드가 위치한 장소

- `dist`: 웹팩이 번들링된 결과를 저장하는 장소

### 패키지 생성

```
npm init
```

### 패키지 설치

```
// React
npm i react react-dom

// Webpack
npm i -D webpack webpack-cli webpack-dev-server

// Webpack Plugin
npm i -D babel-loader html-webpack-plugin clean-webpack-plugin css-loader style-loader

// Babel
npm i -D @babel/core @babel/preset-env @babel/preset-react
```

아래 방법으로 플러그인을 추가해주면, 컴포넌트마다 `import React from "react"` 선언을 꼭 해주지 않아도 된다.

리액트 라이브러리가 필요한 곳에는 웹팩이 알아서 넣어주기 때문이다.

자주 사용하는 라이브러리가 있다면 추가해두면 편하다.

```
new webpack.ProvidePlugin({
  "React": "react",
})
```

### 웹팩 설정

```
// webpack.config.js

const path = require("path");
const HtmlWebpackPlugin = require("html-webpack-plugin")
const { CleanWebpackPlugin } = require("clean-webpack-plugin")

module.exports = {
  name: "webpack-and-babel", // 설정 이름
  mode: "development", // 설정 모드
  devtool: "eval",
  entry: {
    app: "./src/index.js",
  },
  module: {
    rules: [
      { // 리액트 바벨 설정
        test: /\.js/,
        exclude: /node_modules/,
        use: {
          loader: "babel-loader",
          options: {
            presets: ["@babel/preset-env", "@babel/preset-react"]
          },
        },
      },
      {
        test: /\.css$/i,
        use: ["style-loader", "css-loader"],
      },
    ]
  },
  plugins: [
    new CleanWebpackPlugin(),
    new HtmlWebpackPlugin(
      {
        template: "./public/index.html", // 템플릿 설정
        minify: true, // 압축 설정
      }
    ),
    new webpack.ProvidePlugin({ // 리액트 자동 로드
      "React": "react",
    })
  ],
  output: {
    path: path.resolve(__dirname, "dist"),
    filename: "app.js",
  },
  devServer: { // 개발 서버 설정
    static: "./dist",
    port: 3000,
    hot: true, // 핫 모듈 교체(HMR*) 활성화
    compress: true,
    open: true,
  },
}
```

참고: [모듈 번들러와 웹팩](https://github.com/soonzero/TIL/blob/main/JS/모듈%20번들러와%20웹팩.md#전체-코드)

#### \* devServer HMR 설정

```
devServer: { // 개발 서버 설정
    static: "./dist",
    port: 3000, // 포트 설정
    hot: true, // 핫 모듈 교체(HMR*) 활성화
    compress: true, // 압축 설정
    open: true, // 기본 브라우저에서 실행
  }
```

### `package.json`

패키지와 웹팩 설정은 모두 끝났고, `package.json` 파일에 스크립트를 작성해야 한다.

```
// package.json

"scripts": {
  "test": "echo \"Error: no test specified\" && exit 1",
  "dev": "webpack serve --env NODE_ENV=development",
  "build": "webpack --mode=production",
}
```

- `npm run dev`: 웹팩 dev 서버 실행 명령어

- `npm run build`: 웹팩 번들링 명령어

### 개발 서버 실행

간단히 코드를 작성하고

```
npm run dev
```

개발 서버를 실행해주면 된다!

<img src="https://user-images.githubusercontent.com/95613159/175472029-430931cd-0c92-48b9-9681-1c0755b50d7f.png" alt="success"/>
