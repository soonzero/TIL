# map 함수와 key 속성

고정적인 배열이 아니라면 배열의 인덱스를 하나하나 조회해가며 렌더링하는 방법은 동적인 배열을 렌더링하기 어렵다.

일반적으로 동적인 배열을 렌더링 할 때에는 자바스크립트 배열의 내장함수인 `map()` 함수를 사용한다.

`map()`함수는 배열 안에 있는 각 원소를 변환하여 새로운 배열을 만들어주는데,

리액트에서 동적인 배열을 렌더링해야하는 경우에는 이 함수를 이용해서 일반 데이터 배열을 리액트 엘리먼트의 배열로 변환해주면 된다.

## map함수 이용 방법

```
const users = [
  {
    id: 1,
    username: 'velopert',
    email: 'public.velopert@gmail.com'
  },
  {
    id: 2,
    username: 'tester',
    email: 'tester@example.com'
  },
  {
    id: 3,
    username: 'liz',
    email: 'liz@example.com'
  }
];
```

만약 다음과 같은 내용을 컴포넌트로 렌더링하기 위해서는

```
const App = () => {
  ...
  return (
    <div>
      {users.map(user => (
        <User user={user} />
      ))}
    </div>
  )
}
```

이렇게 `map()` 함수를 이용해서 배열의 모든 원소를 렌더링할 수 있다.

하지만 리액트에서 배열을 렌더링하기 위해서는 `key`라는 props를 꼭 설정해줘야 한다.

`key` 값은 각 요소들마다 가지고 있는 고유값으로 설정해야 하므로 일반적으로는 `id`를 `key`로 사용한다.

만약 배열의 요소들이 가지고 있는 고유한 값이 없다면 콜백함수의 두 번째 파라미터 `index`를 `key` 값으로 사용할 수 있다.

```
const App = () => {
  ...
  return (
    <div>
      {users.map((user, index) => (
        <User user={user} key={index} />
      ))}
    </div>
  )
}
```

그럼 리액트에서는 왜 고유 요소에 `key` 설정을 하는 것을 권장할까?

## key의 존재 유무에 따른 업데이트 방식

리액트에서 배열 렌더링 시 `key` props 설정을 권장하는 이유는 효율적인 배열 업데이트 때문이다.

```
const array = ["a", "b", "c", "d"]
```

예를 들어 이와 같은 배열이 있고, 이 배열을 다음과 같이 렌더링한다고 가정해보자.

```
array.map(item => <div>{item}</div>);
```

위 배열의 b와 c 사이에 z를 삽입하게 된다면,

리렌더링 시 `<div>b</div>`와 `<div>c</div>` 사이에 새 `div` 태그를 삽입하게 되는 것이 아니라

기존의 c가 z로 바뀌고, z는 c로 바뀌고, c는 d로 바뀌고, 맨 마지막에 있는 d가 새로 삽입되는 것이다.

<img src="https://i.imgur.com/3rkaiY1.gif" alt="key가 없다면?" />

또 a를 제거하게 된다면, 위 사진처럼 a -> b, b -> z, z -> c, c -> d 가 되고, 맨 마지막의 d가 제거된다.

위 방법은 매우 비효율적지만, `key` 속성을 추가해줌으로써 개선할 수 있다.

```
[
  {
    id: 0,
    text: 'a'
  },
  {
    id: 1,
    text: 'b'
  },
  {
    id: 2,
    text: 'c'
  },
  {
    id: 3,
    text: 'd'
  }
];
```

객체에 위와 같이 `key`로 사용할 수 있는 고유값이 있고 다음과 같이 렌더링된다면

배열이 업데이트될 때 `key`가 없을 때처럼 비효율적인 업데이트가 진행되지 않고,

수정되지 않는 기존의 값은 그대로 두면서 원하는 곳에 내용을 삽입하거나 삭제한다.

<img src="https://i.imgur.com/yEUS6Bx.gif" alt="key가 있다면?" />

따라서 배열을 렌더링할 때에는 고유한 `key` 값의 유무가 굉장히 중요하며,

배열 내에 **중복되는** `key`가 있을 때에는 렌더링 시에 오류메시지가 콘솔에 출력되고 업데이트가 제대로 이루어지지 않게 된다.
