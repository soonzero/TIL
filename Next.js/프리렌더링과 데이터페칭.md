# Next.js

## Pre-rendering and Data Fetching

- Pre-rendering

  - Next.js는 기본적으로 모든 페이지를 프리렌더링한다. 즉, 클라이언트 사이드 자바스크립트로 페이지에 대한 전체 HTML을 생성하는 대신 각 페이지에 대한 HTML을 사전에 생선하기 때문에, 성능과 SEO 측면에서 더 나은 결과를 제공한다. 미리 생성된 HTML은 해당 페이지에서 필요로 하는 최소한의 자바스크립트 코드로 되어있다.

    - Hydration(수화): 페이지의 자바스크립트 코드가 실행되고 페이지를 interactive하게 만드는 것.

    <br />

    <img src="https://velog.velcdn.com/images%2Fjaewoneee%2Fpost%2Fa86e0ea0-d242-472f-ad9b-a14794992d19%2Fpre-rendering.png" alt="Pre-rendering(Using Next.js)" />

    - 초기 로드: 프리렌더링 된 HTML이 출력된다.

    - 수화: 리액트 컴포넌트가 초기화되고 앱이 interactive 상태가 된다.

    - 만약 `<Link />` 태그와 같이 interactive한 컴포넌트를 갖고 있다면, 해당 요소는 JS가 로드된 후에 활성화된다.

    <br />

    <img src="https://velog.velcdn.com/images%2Fjaewoneee%2Fpost%2Fe8d51f8a-fcb9-44b2-9017-3b98d05a0363%2Fno-pre-rendering.png" alt="No Pre-rendering(Plain React.js)" />

    <br />

    - 초기 로드: 앱이 렌더링되지 않는다.

    - 수화: 리액트 컴포넌트가 초기화되고 앱이 interactive 상태가 된다.

<br />

- Pre-rendering and Data Fetching

  - Next.js는 정적 생성과 SSR 두 가지의 프리 렌더링을 제공한다. 둘은 **언제** HTML이 생성되느냐에 따라 다르다.

  - Next.js는 각 페이지에 대한 렌더링 방식을 선택할 수 있도록 했다. 일부 페이지는 정적 생성 방식으로 렌더링하고, 나머지 페이지는 서버 사이드 렌더링 방식을 사용하는 '하이브리드' Next.js 앱을 만들 수 있다는 의미이다.

    <br />

    <img src="https://velog.velcdn.com/images%2Fjaewoneee%2Fpost%2F53360988-f9de-4b56-acca-bc8954f705cc%2Fper-page-basis.png" alt="per page basis">

    <br />

    - Static Generation(정적 생성): HTML을 빌드 타임에 생성하는 방식이며, 생성된 HTML은 매 요청마다 재사용된다.

    <br />

    <img src="https://velog.velcdn.com/images%2Fjaewoneee%2Fpost%2F6a1751f2-fb56-4751-bac6-04de30189f77%2Fstatic-generation.png" alt="static generation">

    <br />

    - SSR(서버 사이드 렌더링): 요청 시에 HTML이 생성된다.

    <br />

    <img src="https://velog.velcdn.com/images%2Fjaewoneee%2Fpost%2Fc3c3138b-f876-458b-89ba-b704558b6dd2%2Fserver-side-rendering.png" alt="ssr">

  - 사용자가 요청하기 전에 프리렌더링 되어야 한다면, 정적 생성 방식을 사용하는 것이 좋다. 예를 들어 상품 목록 페이지, 도움말 및 문서 페이지 등이 있겠다.

  - 사용자의 페이지가 꾸준히 업데이트되는 데이터를 출력한다면 페이지의 컨텐츠는 요청할 때마다 바뀌어야 하므로, 서버 사이드 렌더링을 사용하는 것이 좋다. 속도는 느릴 수 있지만, 항상 최신으로 업데이트된 상태를 유지할 수 있다. 아니면 클라이언트 사이드 렌더링을 사용하는 것도 방법이 될 수 있겠다.

<br />

- Static Generation

  <img src="https://velog.velcdn.com/images%2Fjaewoneee%2Fpost%2Fe91cbe06-00bf-4fb0-a684-c0993a6ec69f%2Fstatic-generation-without-data.png" alt="static generation without data">

  - without 외부 데이터

  <br />

  <img src="https://velog.velcdn.com/images%2Fjaewoneee%2Fpost%2F856aaf7a-d5f5-4842-8914-25bd060b7dda%2Fstatic-generation-with-data.png" alt="static generation without data">

  - with 외부 데이터

    - `getStaticProps`: Next.js에서 페이지 컴포넌트를 export할 때 이 async 함수도 같이 export할 수 있는데, Next.js가 빌드 타임에 이 페이지를 프리렌더링 할 때 데이터를 먼저 해결하라고 명령하는 것이라고 볼 수 있다. 그리고 `getStaticProps`는 page에서만 export될 수 있는데, 리액트는 페이지가 렌더링 되기 이전에 모든 필요한 데이터를 가지고 있어야 하기 때문이다.

      ```
      export default function Home(props) { ... }

      export async function getStaticProps() {
        const data = ...

        return {
          props: ...
        }
      }
      ```

<br />

- Fetching Data at Request Time

  - 빌드 타임이 아니라 사용자가 요청할 때에 데이터를 가져와야 한다면, SSR을 시도해 볼 수 있다.

    <img src="https://velog.velcdn.com/images%2Fjaewoneee%2Fpost%2F4f98136b-b239-4a74-9a22-033737439b8c%2FGroup%201%20(1).png" alt="SSR with data" />

    <br />

    - SSR을 사용하려면 `getServerSideProps`를 export 해야한다.

<br />

- Client-Side Rendering

  - 만약 데이터를 프리렌더링 할 필요가 없다면, CSR을 사용할 수 있다.

    <img src="https://velog.velcdn.com/images%2Fjaewoneee%2Fpost%2F47f01281-ff8a-429e-981d-f1a44008f4c2%2FGroup%203.png" alt="Static Generation without Data + Fetch Data on the Client-Side" />

    <br />

    - 외부 데이터를 필요로 하지 않는 페이지의 일부분을 정적으로 생성하고, 페이지가 로드될 때 클라이언트 단의 자바스크립트를 사용해서 외부 데이터를 가져오고 나머지 부분을 구현한다.

    - 사용자의 대시보드 같은 유형의 페이지에 CSR을 적용하기 적합하다. 대시보드는 private한 사용자의 고유 페이지인데다가, SEO와 전혀 관련이 없고, 프리렌더링도 필요 없다. 게다가 데이터 업데이트가 잦아서 요청 할 때마다 데이터를 가져와야 하기 때문이다.

    - [SWR](https://swr.vercel.app/ko): Next.js가 만든 데이터 fetching을 위한 React Hook
